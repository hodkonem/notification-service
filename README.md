# notification-service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:
- **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ Kafka (—Å–æ–∑–¥–∞–Ω–∏–µ / —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** ‚Äî REST API –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ email

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å `user-service`.

---

## üß∞ Prerequisites

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

- **Java 21**
- **Docker** –∏ **Docker Compose**
- **Gradle Wrapper** (—É–∂–µ –≤–∫–ª—é—á—ë–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)

---

## üöÄ Quick Start

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
–ü–æ–¥–Ω–∏–º–∞–µ—Ç Kafka, MailHog –∏ Kafka UI:

```bash
docker compose up -d
```

---

### 2. –ü—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤

```bash
./gradlew clean test
```

–í–∫–ª—é—á–∞–µ—Ç:
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã Kafka (Testcontainers)
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ email (GreenMail)
- REST API —Ç–µ—Å—Ç—ã

---

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: —á–µ—Ä–µ–∑ Gradle
```bash
SPRING_PROFILES_ACTIVE=dev ./gradlew bootRun
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: —á–µ—Ä–µ–∑ IntelliJ IDEA
- Run ‚Üí Edit Configurations
- Active profiles: `dev`
- Run `NotificationServiceApplication`

---

## üîå –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å                | –ü–æ—Ä—Ç |
|----------------------|------|
| notification-service | 8085 |
| MailHog (SMTP)       | 1025 |
| MailHog (Web UI)     | 8025 |
| Kafka                | 9092 |
| Kafka UI             | 8089 |

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)

> –î–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `docker compose up -d` –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **Swagger UI (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª—å `dev`)**  
  http://localhost:8085/swagger-ui

- **MailHog UI (–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–∏—Å–µ–º)**  
  http://localhost:8025

- **Kafka UI**  
  http://localhost:8089

---

## üì¨ REST API

### –û—Ç–ø—Ä–∞–≤–∫–∞ email –≤—Ä—É—á–Ω—É—é

`POST /api/v1/notifications/email`

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST http://localhost:8085/api/v1/notifications/email \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@test.local",
    "subject": "Hello",
    "text": "Message from notification-service"
  }'
```

–û—Ç–≤–µ—Ç: `202 Accepted`

---

## üì° Kafka —Ä–µ–∂–∏–º

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Kafka-—Ç–æ–ø–∏–∫:

```
user.notifications
```

–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
```json
{
  "operation": "CREATED",
  "email": "user@test.local"
}
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- `CREATED` ‚Äî –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω
- `DELETED` ‚Äî –∞–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
- **Testcontainers** ‚Äî Kafka
- **GreenMail** ‚Äî SMTP
- **MockMvc** ‚Äî REST API

Kafka listener –∏ Swagger UI **–æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –ø—Ä–æ—Ñ–∏–ª–µ**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.

---

## ‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏

| –ü—Ä–æ—Ñ–∏–ª—å   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `default` | –æ–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ |
| `dev`     | Swagger UI –≤–∫–ª—é—á—ë–Ω |
| `test`    | Kafka –∏ Swagger –≤—ã–∫–ª—é—á–µ–Ω—ã |
| `kafka-it`| –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ Kafka-—Ç–µ—Å—Ç—ã |

---

## üìé –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

- `user-service` ‚Äî —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏–π)
